# Example remap configurations for sai3-bench replay command
# This file demonstrates all remapping strategies
# 
# NOTE: This is NOT a workload config file - it's for the replay command:
#   sai3-bench replay --op-log trace.tsv.zst --remap-config remap_examples.yaml
#
# Remap configs transform source URIs to target URIs during replay

rules:
  # 1→1: Simple bucket rename
  # Maps all objects from "old-bucket" to "new-bucket/archived/"
  - match:
      bucket: "old-bucket"
    map_to:
      bucket: "new-bucket"
      prefix: "archived/"
  
  # 1→N: Fanout to multiple targets (round-robin)
  # Distributes objects from "source/media/" across 3 replicas
  - match:
      bucket: "source"
      prefix: "media/"
    map_to_many:
      targets:
        - bucket: "replica1"
          prefix: "media/"
        - bucket: "replica2"
          prefix: "media/"
        - bucket: "replica3"
          prefix: "media/"
      strategy: "round_robin"  # Alternates: file1→replica1, file2→replica2, file3→replica3, file4→replica1, ...
  
  # 1→N: Fanout with sticky-key strategy
  # Ensures same key always goes to same replica (consistent hashing)
  - match:
      bucket: "cache"
      prefix: "data/"
    map_to_many:
      targets:
        - bucket: "cache-node1"
          prefix: "data/"
        - bucket: "cache-node2"
          prefix: "data/"
      strategy: "sticky_key"  # Same key always maps to same target
  
  # N→1: Consolidate multiple sources to single target
  # Merges objects from temp-1, temp-2, temp-3 into "consolidated/merged/"
  - match_any:
      - bucket: "temp-1"
      - bucket: "temp-2"
      - bucket: "temp-3"
    map_to:
      bucket: "consolidated"
      prefix: "merged/"
  
  # Regex: Advanced pattern matching with capture groups
  # Transforms "s3://prod-db/data/..." to "s3://staging-db/data/..."
  - regex: "^s3://prod-([^/]+)/(.*)$"
    replace: "s3://staging-$1/$2"
  
  # Regex: Cross-cloud migration (S3 to GCS)
  # Transforms "s3://my-bucket/path" to "gs://my-bucket/path"
  - regex: "^s3://(.*)$"
    replace: "gs://$1"
